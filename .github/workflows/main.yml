name: Liascript Automation
on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Release version (e.g., v1.0.0)'
        required: true
        default: 'v1.0.0'
jobs:
  run_liascript_automation:
    runs-on: ubuntu-latest
    permissions:
      contents: write # This grants permission to create and update releases
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install Node.js dependencies
      run: npm install
      
    - name: Install LiaScript globally
      run: npm install -g @liascript/devserver
      
    - name: Create output directories
      run: |
        mkdir -p dist/pdf
        mkdir -p dist/scorm
        
    - name: Generate LiaScript PDF
      run: |
        if npm run | grep -q "generate-pdf"; then
          npm run generate-pdf
        else
          liascript --format pdf --output dist/pdf "Test 01.md"
        fi
        
    - name: Generate LiaScript SCORM
      run: |
        if npm run | grep -q "generate-scorm"; then
          npm run generate-scorm
        else
          liascript --format scorm --output dist/scorm "Test 01.md"
        fi
        
    - name: List generated files
      run: |
        echo "Generated files:"
        find dist/ -type f -name "*" | sort
        
    - name: Create GitHub Release
      uses: softprops/action-gh-release@v2
      if: ${{ success() }}
      with:
        tag_name: ${{ inputs.version }}
        name: LiaScript Release - ${{ inputs.version }}
        body: |
          Automated release of LiaScript content for version ${{ inputs.version }}.
          
          **Included files:**
          - PDF version for reading/printing
          - SCORM package for LMS integration
          - IMS package (if generated)
          
          Generated from: `Test 01.md`
        draft: false
        prerelease: false
        files: |
          dist/**/*.pdf
          dist/**/*.zip
          dist/**/*.xml
          dist/**/*
